from http.server import BaseHTTPRequestHandler, HTTPServer
from urllib.parse import parse_qs, urlparse
import serial
import time
from serial.tools import list_ports
ports = list_ports.comports()
for port in ports:
    portname = port.device
ser = serial.Serial(portname, 115200/2)
time.sleep(5)
class MyRequestHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        parsed_url = urlparse(self.path)
        query_params = parse_qs(parsed_url.query)

        action = query_params.get('Action', [''])[0]
        timer = query_params.get('Time', [''])[0]
        cycle = query_params.get('Cycle', [''])[0]
        line = query_params.get('Line', [''])[0]
        print(action,timer,cycle,line)
        if action == 'rotate':
            message = f"rotate: timer={timer}, cycle={cycle}, line={line}\n"
            print(message)
            ser.write(message.encode())
            response = 'Action "rotate" is being performed with parameters: Timer={}, Cycle={}, Line={}'.format(time, cycle, line)
        else:
            response = 'Unknown action: {}'.format(action)

        self.send_response(200)
        self.send_header('Content-type', 'text/plain')
        self.end_headers()
        self.wfile.write(response.encode())
server_address = ('localhost', 8000)
httpd = HTTPServer(server_address, MyRequestHandler)
print('Server is running on port 8000...')
httpd.serve_forever()
