#if defined(ARDUINO) && ARDUINO >= 100
#include "Arduino.h"
#else
#include "WProgram.h"
#endif
#include "bitlash.h"

#include <Adafruit_NeoPixel.h>

#define LED_PIN 13
#define LED_COUNT 8

Adafruit_NeoPixel strip(LED_COUNT, LED_PIN, NEO_GRB);

numvar func_tone(void) {
  if (getarg(0) == 2)
    tone(getarg(1), getarg(2));
  else
    tone(getarg(1), getarg(2), getarg(3));
  return 0;
}

numvar func_notone(void) {
  noTone(getarg(1));
  return 0;
}

numvar func_light() {
  for (int i = 0; i < strip.numPixels(); i++) {
    strip.setPixelColor(i, strip.Color(0, 0, 255));
  }
  strip.show();
  delay(100);
  return 0;
}                                                                                                                                           
numvar func_set_light2() {
  byte r = getarg(1);
  byte g = getarg(2);
  byte b = getarg(3);
 for (int i = 0; i < strip.numPixels(); i++) {
  strip.setPixelColor(i, strip.Color(r, g, b)); // Установить цвет на указанные значения RGB
  strip.show();
  return 0;
}
numvar func_clear_light() {
  for (int i = 0; i < strip.numPixels(); i++) {
    strip.setPixelColor(i, strip.Color(0, 0, 0)); // Установить цвет на черный (выключено)
  }
  strip.show();
  return 0;
}

numvar func_set_light() {
  int i = getarg(1);
  byte r = getarg(2);
  byte g = getarg(3);
  byte b = getarg(4);
  strip.setPixelColor(i, strip.Color(r, g, b)); // Установить цвет на указанные значения RGB
  strip.show();
  return 0;
}


void setup(void) {
  initBitlash(57600);

  addBitlashFunction("tone", (bitlash_function)func_tone);
  addBitlashFunction("notone", (bitlash_function)func_notone);                              
  addBitlashFunction("light", (bitlash_function)func_light2);                   
  //addBitlashFunction("light", (bitlash_function)func_light);
  addBitlashFunction("clear", (bitlash_function)func_clear_light);
  addBitlashFunction("set", (bitlash_function)func_set_light);
}

void loop(void) {
  runBitlash();
}
